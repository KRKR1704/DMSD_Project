{% extends "base.html" %}

{% block content %}
<div class="container card">
    <h1>{% if publication %}Edit{% else %}Create{% endif %} Publication</h1>
    
    <form method="POST">
        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="{{ publication.title if publication else '' }}" required>
        </div>

        <div class="form-group">
            <label for="pub_date">Publication Date:</label>
            <input type="date" id="pub_date" name="pub_date" value="{{ publication.pub_date if publication else '' }}">
        </div>

        <div class="form-group">
            <label for="venue">Venue (Journal/Conference):</label>
            <input type="text" id="venue" name="venue" value="{{ publication.venue if publication else '' }}" placeholder="e.g., Nature, ICML">
        </div>

        <div class="form-group">
            <label for="doi">DOI:</label>
            <input type="text" id="doi" name="doi" value="{{ publication.doi if publication else '' }}" placeholder="e.g., 10.1234/example">
        </div>

        <div class="form-group">
            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="">-- Select Status --</option>
                <option value="draft" {% if publication and publication.status == 'draft' %}selected{% endif %}>Draft</option>
                <option value="submitted" {% if publication and publication.status == 'submitted' %}selected{% endif %}>Submitted</option>
                <option value="accepted" {% if publication and publication.status == 'accepted' %}selected{% endif %}>Accepted</option>
                <option value="published" {% if publication and publication.status == 'published' %}selected{% endif %}>Published</option>
            </select>
        </div>

            <div class="form-group">
                <label for="primary_author">Primary Author (required):</label>
                <select id="primary_author" name="primary_author" required>
                    <option value="">-- Select Member --</option>
                    {% for m in members %}
                    <option value="{{ m.member_id }}" {% if primary_id and primary_id == m.member_id %}selected{% endif %}>{{ m.member_id }} - {{ m.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label>Other Authors (optional):</label>
                <div style="max-height:200px;overflow:auto;border:1px solid #eee;padding:8px;border-radius:4px;">
                    {% for m in members %}
                    <label style="display:block;margin-bottom:6px;"><input type="checkbox" name="co_authors" value="{{ m.member_id }}" {% if existing_ids and (m.member_id in existing_ids) %}checked{% endif %}> {{ m.member_id }} - {{ m.name }}</label>
                    {% endfor %}
                </div>
                <small class="muted">Select additional authors. The primary author will be included automatically if not checked.</small>
            </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary">{% if publication %}Update{% else %}Create{% endif %}</button>
            <a href="{{ url_for('view_all_publications') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- Use global styles from static/css/style.css for consistent layout -->
{% endblock %}
